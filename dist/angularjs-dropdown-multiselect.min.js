!function(e){"use strict";var t=e.module("angularjs-dropdown-multiselect",[]);function n(e,t){var n=!1;return e.some((function(e){if(e===t)return n=!0,!0})),n}function s(e,t){var n=-1,s=-1;return e.some((function(e){var o=!0;if(s+=1,Object.keys(t).forEach((function(n){e[n]!==t[n]&&(o=!1)})),o)return n=s,!0})),n}t.directive("dmDropdownStaticInclude",["$compile",function(e){return function(t,n,s){var o=s.dmDropdownStaticInclude,l=n.html(o).contents();e(l)(t)}}]),t.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(t,o,l,i){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",disabled:"="},template:function(e,t){var n=!!t.checkboxes,s='<div class="multiselect-parent btn-group dropdown-multiselect" ng-class="{open: open}">';return s+='<button ng-disabled="disabled" type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}</button>',s+="<div class=\"dropdown-menu\" ng-if=\"open\" ng-class=\"{'dropdown-menu-right':settings.pullRight}\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto', overflow: 'auto' }\" >",s+='<div class="dropdown-divider" ng-if="settings.selectByGroups && settings.showEnableSearchButton"></div>',s+='<a ng-if="settings.showEnableSearchButton && settings.enableSearch" ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.disableSearch}}</a>',s+='<a ng-if="settings.showEnableSearchButton && !settings.enableSearch" ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.enableSearch}}</a>',s+='<div ng-if="settings.enableSearch" class="dropdown-header"><div class="input-group"><div class="input-group-prepend"><div class="input-group-text"><i class="fas fa-filter"></i></div></div><input type="text" class="form-control searchField" ng-keydown="keyDownSearchDefault($event); keyDownSearch($event, input.searchFilter);" ng-model="input.searchFilter" placeholder="{{texts.filterPlaceholder}}" /></div></div>',s+='<div class="dropdown-divider" ng-if="settings.enableSearch"></div>',s+='<div class="check-all-selections" ng-if="settings.showCheckAll || settings.showUncheckAll"><span ng-if="settings.showCheckAll && settings.selectionLimit !== 1"><a ng-keydown="keyDownLink($event)" data-ng-click="selectAll()" tabindex="-1" id="selectAll"><span class="fas fa-check-square"></span>  {{texts.checkAll}}</a></span> <span ng-if="settings.showCheckAll && settings.showUncheckAll"> | </span> <span ng-if="settings.showUncheckAll"><a ng-keydown="keyDownLink($event)" data-ng-click="deselectAll();" tabindex="-1" id="deselectAll"><span class="fas fa-times"></span>   {{texts.uncheckAll}}</a></span></div>',s+='<div class="dropdown-divider" ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)"></div>',s+='<div class="dropdown-divider" ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)"></div>',s+='<a ng-repeat="currentGroup in settings.selectByGroups track by $index" ng-click="selectCurrentGroup(currentGroup)" ng-class="{\'dropdown-selected-group\': selectedGroup === currentGroup}" tabindex="-1">{{::texts.selectGroup}} {{::getGroupLabel(currentGroup)}}</a>',s+='<div class="dropdown-divider" ng-if="(settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll || settings.showEnableSearchButton"></div>',t.groupBy?(s+='<div class="dropdown-item" ng-repeat-start="option in orderedItems | filter:getFilter(input.searchFilter)" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupLabel(getPropertyForObject(option, settings.groupBy)) }}</div>',s+='<div class="dropdown-item" ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" ng-repeat-end role="presentation">'):s+='<div class="dropdown-item" ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" role="presentation" ng-repeat="option in options | filter:getFilter(input.searchFilter)">',s+='<a ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="option" tabindex="-1" ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true, $event)" ng-disabled="option.disabled">',s+=n?'<div class="form-check"><input class="checkboxInput form-check-input" type="checkbox" ng-disabled="option.disabled" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /><label dm-dropdown-static-include="{{settings.template}}"></label></div></a>':'<span data-ng-class="{\'fas fa-check\': isChecked(getPropertyForObject(option,settings.idProp))}"> </span> <span dm-dropdown-static-include="{{settings.template}}"></span></a>',s+="</div>",s+='<div class="dropdown-divider" ng-show="settings.selectionLimit > 1"></div>',s+='<div role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></div>',n&&(s+='<div class="border-top pt-2"><div class="text-center"><button class="btn btn-primary" ng-click="toggleDropdown()">Apply</button></div></div>'),(s+="</div>")+"</div>"},link:function(l,i,r){var c=i.children()[0];function a(t){var n={};return""===l.settings.externalIdProp?n[l.settings.idProp]=t:(n[l.settings.externalIdProp]=t,e.forEach(l.options,(function(e,s){e.id==t&&(n.label=e.label)}))),n}function d(e){for(var t in e)delete e[t]}function g(e){var t=i.find("button"),n=document.createElement("canvas").getContext("2d");return n.font=t.css("font-size")+t.css("font-family"),n.originalFont=t.css("font-size")+t.css("font-family"),n.fillStyle="#000000",n.measureText(e).width}function p(){setTimeout((function(){var t=e.element(i)[0].querySelector(".option");e.isDefined(t)&&null!=t&&t.focus()}),0)}l.toggleDropdown=function(){l.open?l.close():l.open=!0,l.settings.keyboardControls&&l.open&&(1===l.settings.selectionLimit&&l.settings.enableSearch?setTimeout((function(){e.element(i)[0].querySelector(".searchField").focus()}),0):p())},l.checkboxClick=function(e,t){l.setSelectedItem(t,!1,!0,e),e.stopImmediatePropagation()},l.externalEvents={onItemSelect:e.noop,onItemDeselect:e.noop,onSelectAll:e.noop,onDeselectAll:e.noop,onInitDone:e.noop,onMaxSelectionReached:e.noop,onSelectionChanged:e.noop,onClose:e.noop},l.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,showEnableSearchButton:!1,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:r.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:e.noop,styleActive:!1,keyboardControls:!1,template:"{{getPropertyForObject(option, settings.displayProp)}}",searchField:"$",showAllSelectedText:!1,pullRight:!1},l.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",filterPlaceholder:"Filter",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked",disableSearch:"Disable search",enableSearch:"Enable search",selectGroup:"Select all:",allSelectedText:"All"},l.input={searchFilter:l.searchFilter||""},e.isDefined(l.settings.groupBy)&&l.$watch("options",(function(n){e.isDefined(n)&&(l.orderedItems=t("orderBy")(n,l.settings.groupBy))})),l.$watch("selectedModel",(function(e){Array.isArray(e)?l.singleSelection=!1:l.singleSelection=!0})),l.close=function(){l.open=!1,l.externalEvents.onClose()},l.selectCurrentGroup=function(e){l.selectedModel.splice(0,l.selectedModel.length),l.orderedItems&&l.orderedItems.forEach((function(t){t[l.groupBy]===e&&l.setSelectedItem(l.getPropertyForObject(t,l.settings.idProp),!1,!1)})),l.externalEvents.onSelectionChanged()},e.extend(l.settings,l.extraSettings||[]),e.extend(l.externalEvents,l.events||[]),e.extend(l.texts,l.translationTexts),l.singleSelection=1===l.settings.selectionLimit,l.singleSelection&&e.isArray(l.selectedModel)&&0===l.selectedModel.length&&d(l.selectedModel),l.settings.closeOnBlur&&o.on("click",(function(t){if(l.open){for(var s=t.target.parentElement,o=!1;e.isDefined(s)&&null!==s&&!o;)s.className.split&&n(s.className.split(" "),"multiselect-parent")&&!o&&s===c&&(o=!0),s=s.parentElement;o||l.$apply((function(){l.close()}))}})),l.getGroupLabel=function(e){return null!==l.settings.groupByTextProvider?l.settings.groupByTextProvider(e):e},l.getButtonText=function(){if(l.settings.dynamicTitle&&(l.selectedModel.length>0||e.isObject(l.selectedModel)&&Object.keys(l.selectedModel).length>0)){if(l.settings.smartButtonMaxItems>0){g("...");var t=i[0].offsetWidth-24-2-8,n=[];e.forEach(l.options,(function(e){if(l.isChecked(l.getPropertyForObject(e,l.settings.idProp))){var t=l.getPropertyForObject(e,l.settings.displayProp),s=l.settings.smartButtonTextConverter(t,e);n.push(s||t)}})),l.selectedModel.length>l.settings.smartButtonMaxItems&&(n=n.slice(0,l.settings.smartButtonMaxItems)).push("...");for(var s=n.join(", "),o=s.length-4;g(s)>t;)"..."!==n[n.length-1]&&(n.push("..."),s+="..."),s=s.slice(0,o)+s.slice(o+1),o--;return s}var r;return 0===(r=l.singleSelection?null!==l.selectedModel&&e.isDefined(l.selectedModel[l.settings.idProp])?1:0:e.isDefined(l.selectedModel)?l.selectedModel.length:0)?l.texts.buttonDefaultText:l.settings.showAllSelectedText&&r===l.options.length?l.texts.allSelectedText:r+" "+l.texts.dynamicButtonTextSuffix}return l.texts.buttonDefaultText},l.getPropertyForObject=function(t,n){if(e.isDefined(t)&&t.hasOwnProperty(n))return t[n]},l.selectAll=function(){var n;l.deselectAll(!0),l.externalEvents.onSelectAll(),n=t("filter")(l.options,l.getFilter(l.input.searchFilter)),e.forEach(n,(function(e){l.setSelectedItem(e[l.settings.idProp],!0,!1)})),l.externalEvents.onSelectionChanged(),l.selectedGroup=null},l.deselectAll=function(e){(e=e||!1)||l.externalEvents.onDeselectAll(),l.singleSelection?d(l.selectedModel):l.selectedModel.splice(0,l.selectedModel.length),e||l.externalEvents.onSelectionChanged(),l.selectedGroup=null},l.setSelectedItem=function(t,n,o,i){var r,c,g,p=a(t),u=null;if(""===l.settings.externalIdProp?(r=l.options,c=p,r.some((function(e){var t=!0;if(Object.keys(c).forEach((function(n){e[n]!==c[n]&&(t=!1)})),t)return g=e,!0})),u=g):u=p,l.singleSelection)d(l.selectedModel),e.extend(l.selectedModel,u),o&&l.externalEvents.onItemSelect(u,i),(l.settings.closeOnSelect||l.settings.closeOnDeselect)&&l.close();else{n=n||!1;var h=-1!==s(l.selectedModel,p);!n&&h?(l.selectedModel.splice(s(l.selectedModel,p),1),l.externalEvents.onItemDeselect(u,i),l.settings.closeOnDeselect&&l.close()):!h&&(0===l.settings.selectionLimit||l.selectedModel.length<l.settings.selectionLimit)&&(l.selectedModel.push(u),o&&l.externalEvents.onItemSelect(u,i),l.settings.closeOnSelect&&l.close(),l.settings.selectionLimit>0&&l.selectedModel.length===l.settings.selectionLimit&&l.externalEvents.onMaxSelectionReached())}o&&l.externalEvents.onSelectionChanged(),l.selectedGroup=null},l.isChecked=function(t){return l.singleSelection?null!==l.selectedModel&&e.isDefined(l.selectedModel[l.settings.externalIdProp])&&l.selectedModel[l.settings.externalIdProp]===a(t)[l.settings.externalIdProp]:-1!==s(l.selectedModel,a(t))},l.externalEvents.onInitDone(),l.keyDownLink=function(t){var n,s=e.element(t.target).scope(),o=t.target.parentNode;if(l.settings.keyboardControls)if(13===t.keyCode||32===t.keyCode)t.preventDefault(),s.option?l.setSelectedItem(l.getPropertyForObject(s.option,l.settings.idProp),!1,!0,t):"deselectAll"===t.target.id?l.deselectAll():"selectAll"===t.target.id&&l.selectAll();else if(38===t.keyCode){for(t.preventDefault(),o.previousElementSibling&&(n=o.previousElementSibling.querySelector("a")||o.previousElementSibling.querySelector("input"));!n&&o;)(o=o.previousElementSibling)&&(n=o.querySelector("a")||o.querySelector("input"));n&&n.focus()}else if(40===t.keyCode){for(t.preventDefault(),o.nextElementSibling&&(n=o.nextElementSibling.querySelector("a")||o.nextElementSibling.querySelector("input"));!n&&o;)(o=o.nextElementSibling)&&(n=o.querySelector("a")||o.querySelector("input"));n&&n.focus()}else 27===t.keyCode&&(t.preventDefault(),l.toggleDropdown())},l.keyDownSearchDefault=function(e){var t,n=e.target.parentNode.parentNode;if(l.settings.keyboardControls)if(9===e.keyCode||40===e.keyCode)e.preventDefault(),p();else if(38===e.keyCode){for(e.preventDefault(),n.previousElementSibling&&(t=n.previousElementSibling.querySelector("a")||n.previousElementSibling.querySelector("input"));!t&&n;)(n=n.previousElementSibling)&&(t=n.querySelector("a")||n.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),l.toggleDropdown())},l.keyDownSearch=function(e,n){var s;l.settings.keyboardControls&&13===e.keyCode&&(1===l.settings.selectionLimit&&l.settings.enableSearch?1===(s=t("filter")(l.options,l.getFilter(n))).length&&l.setSelectedItem(l.getPropertyForObject(s[0],l.settings.idProp),!1,!0,e):l.settings.enableSearch&&l.selectAll())},l.getFilter=function(e){var t={};return t[l.settings.searchField]=e,t},l.toggleSearch=function(e){e&&e.stopPropagation(),l.settings.enableSearch=!l.settings.enableSearch,l.settings.enableSearch||(l.input.searchFilter="")},l.keyDownToggleSearch=function(){l.settings.keyboardControls&&13===event.keyCode&&(l.toggleSearch(),l.settings.enableSearch?setTimeout((function(){e.element(i)[0].querySelector(".searchField").focus()}),0):p())},l.updateSetting=function(e,t){l.settings[e]=t}}}}])}(angular);