!function(e){"use strict";var t=e.module("angularjs-dropdown-multiselect",[]);function n(e,t){var n=!1;return e.some(function(e){if(e===t)return n=!0,!0}),n}function s(e,t){var n=-1,s=-1;return e.some(function(e){var l=!0;if(s+=1,Object.keys(t).forEach(function(n){e[n]!==t[n]&&(l=!1)}),l)return n=s,!0}),n}t.directive("dmDropdownStaticInclude",["$compile",function(e){return function(t,n,s){var l=s.dmDropdownStaticInclude;e(n.html(l).contents())(t)}}]),t.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(t,l,o,i){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",disabled:"="},template:function(e,t){t.checkboxes;var n=!!t.groupBy,s='<div class="multiselect-parent btn-group dropdown-multiselect" ng-class="{open: open}">';return s+='<button ng-disabled="disabled" type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}</button>',s+="<div class=\"dropdown-menu pb-0\" ng-if=\"open\" ng-class=\"{'dropdown-menu-right':settings.pullRight}\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto', overflow: 'auto' }\" >",s+='<div class="dropdown-divider" ng-if="settings.selectByGroups && settings.showEnableSearchButton"></div>',s+='<a ng-if="settings.showEnableSearchButton && settings.enableSearch" ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.disableSearch}}</a>',s+='<a ng-if="settings.showEnableSearchButton && !settings.enableSearch" ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.enableSearch}}</a>',s+='<div ng-if="settings.enableSearch" class="dropdown-header"><div class="input-group"><div class="input-group-prepend"><div class="input-group-text"><i class="fas fa-filter"></i></div></div><input type="text" class="form-control searchField" ng-keydown="keyDownSearchDefault($event); keyDownSearch($event, input.searchFilter);" ng-model="input.searchFilter" placeholder="{{texts.filterPlaceholder}}" /></div></div>',s+='<div class="dropdown-divider" ng-if="settings.enableSearch"></div>',s+='<div class="check-all-selections" ng-if="settings.showCheckAll || settings.showUncheckAll"><span ng-if="settings.showCheckAll && settings.selectionLimit !== 1"><a ng-keydown="keyDownLink($event)" data-ng-click="selectAll()" tabindex="-1" id="selectAll">{{texts.checkAll}}</a></span> <span ng-if="settings.showCheckAll && settings.showUncheckAll"> | </span> <span ng-if="settings.showUncheckAll"><a ng-keydown="keyDownLink($event)" data-ng-click="deselectAll();" tabindex="-1" id="deselectAll">{{texts.uncheckAll}}</a></span></div>',s+='<div class="dropdown-divider mb-0" ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)"></div>',s+='<div class="dropdown-divider mb-0" ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)"></div>',s+='<a ng-repeat="currentGroup in settings.selectByGroups track by $index" ng-click="selectCurrentGroup(currentGroup)" ng-class="{\'dropdown-selected-group\': selectedGroup === currentGroup}" tabindex="-1">{{::texts.selectGroup}} {{::getGroupLabel(currentGroup)}}</a>',s+='<div class="dropdown-divider mb-0" ng-if="(settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll || settings.showEnableSearchButton"></div>',s+='<div class="scrollable-list">',n?(s+='<h6 role="menuitem" class="dropdown-header" ng-repeat-start="option in orderedItems | filter:getFilter(input.searchFilter)" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation">{{ getGroupLabel(getPropertyForObject(option, settings.groupBy)) }}</h6>',s+='<a href ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true, $event)" ng-disabled="option.disabled" ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="dropdown-item" data-ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive, \'disabled\': option.disabled}" ng-repeat-end role="presentation">'):s+='<a href ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true, $event)" ng-disabled="option.disabled" ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="dropdown-item" data-ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive, \'disabled\': option.disabled}" role="presentation" ng-repeat="option in options | filter:getFilter(input.searchFilter)">',s+='<span dm-dropdown-static-include="{{settings.template}}"></span></a>',s+="</a>",s+='<div class="dropdown-divider" ng-show="settings.selectionLimit > 1"></div>',s+='<div role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></div>',s+="</div>",s+='<div class="border-top py-2 px-3"><div class="text-center"><button class="btn btn-primary btn-block" ng-click="toggleDropdown()">Apply</button></div></div>',s+="</div>",s+="</div>"},link:function(o,i,r){var c=i.children()[0];function a(t){var n={};return""===o.settings.externalIdProp?n[o.settings.idProp]=t:(n[o.settings.externalIdProp]=t,e.forEach(o.options,function(e,s){e.id==t&&(n.label=e.label)})),n}function d(e){for(var t in e)delete e[t]}function g(e){var t=i.find("button"),n=document.createElement("canvas").getContext("2d");return n.font=t.css("font-size")+t.css("font-family"),n.originalFont=t.css("font-size")+t.css("font-family"),n.fillStyle="#000000",n.measureText(e).width}function p(){setTimeout(function(){var t=e.element(i)[0].querySelector(".option");e.isDefined(t)&&null!=t&&t.focus()},0)}o.toggleDropdown=function(){o.open?o.close():o.open=!0,o.settings.keyboardControls&&o.open&&(1===o.settings.selectionLimit&&o.settings.enableSearch?setTimeout(function(){e.element(i)[0].querySelector(".searchField").focus()},0):p())},o.checkboxClick=function(e,t){o.setSelectedItem(t,!1,!0,e),e.stopImmediatePropagation()},o.externalEvents={onItemSelect:e.noop,onItemDeselect:e.noop,onSelectAll:e.noop,onDeselectAll:e.noop,onInitDone:e.noop,onMaxSelectionReached:e.noop,onSelectionChanged:e.noop,onClose:e.noop},o.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"auto",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,showEnableSearchButton:!1,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:r.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:e.noop,styleActive:!0,keyboardControls:!1,template:"{{getPropertyForObject(option, settings.displayProp)}}",searchField:"$",showAllSelectedText:!1,pullRight:!1},o.texts={checkAll:"Select all",uncheckAll:"Deselect all",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",filterPlaceholder:"Filter",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked",disableSearch:"Disable search",enableSearch:"Enable search",selectGroup:"Select all:",allSelectedText:"All"},o.input={searchFilter:o.searchFilter||""},e.isDefined(o.settings.groupBy)&&o.$watch("options",function(n){e.isDefined(n)&&(o.orderedItems=t("orderBy")(n,o.settings.groupBy))}),o.$watch("selectedModel",function(e){Array.isArray(e)?o.singleSelection=!1:o.singleSelection=!0}),o.close=function(){o.open=!1,o.externalEvents.onClose()},o.selectCurrentGroup=function(e){o.selectedModel.splice(0,o.selectedModel.length),o.orderedItems&&o.orderedItems.forEach(function(t){t[o.groupBy]===e&&o.setSelectedItem(o.getPropertyForObject(t,o.settings.idProp),!1,!1)}),o.externalEvents.onSelectionChanged()},e.extend(o.settings,o.extraSettings||[]),e.extend(o.externalEvents,o.events||[]),e.extend(o.texts,o.translationTexts),o.singleSelection=1===o.settings.selectionLimit,o.singleSelection&&e.isArray(o.selectedModel)&&0===o.selectedModel.length&&d(o.selectedModel),o.settings.closeOnBlur&&l.on("click",function(t){if(o.open){for(var s=t.target.parentElement,l=!1;e.isDefined(s)&&null!==s&&!l;)s.className.split&&n(s.className.split(" "),"multiselect-parent")&&!l&&s===c&&(l=!0),s=s.parentElement;l||o.$apply(function(){o.close()})}}),o.getGroupLabel=function(e){return null!==o.settings.groupByTextProvider?o.settings.groupByTextProvider(e):e},o.getButtonText=function(){if(!(o.settings.dynamicTitle&&(o.selectedModel.length>0||e.isObject(o.selectedModel)&&Object.keys(o.selectedModel).length>0)))return o.texts.buttonDefaultText;if(o.settings.smartButtonMaxItems>0){g("...");var t,n=i[0].offsetWidth-24-2-8,s=[];e.forEach(o.options,function(e){if(o.isChecked(o.getPropertyForObject(e,o.settings.idProp))){var t=o.getPropertyForObject(e,o.settings.displayProp),n=o.settings.smartButtonTextConverter(t,e);s.push(n||t)}}),o.selectedModel.length>o.settings.smartButtonMaxItems&&(s=s.slice(0,o.settings.smartButtonMaxItems)).push("...");for(var l=s.join(", "),r=l.length-4;g(l)>n;)"..."!==s[s.length-1]&&(s.push("..."),l+="..."),l=l.slice(0,r)+l.slice(r+1),r--;return l}return 0===(t=o.singleSelection?null!==o.selectedModel&&e.isDefined(o.selectedModel[o.settings.idProp])?1:0:e.isDefined(o.selectedModel)?o.selectedModel.length:0)?o.texts.buttonDefaultText:o.settings.showAllSelectedText&&t===o.options.length?o.texts.allSelectedText:t+" "+o.texts.dynamicButtonTextSuffix},o.getPropertyForObject=function(t,n){if(e.isDefined(t)&&t.hasOwnProperty(n))return t[n]},o.selectAll=function(){var n;o.deselectAll(!0),o.externalEvents.onSelectAll(),n=t("filter")(o.options,o.getFilter(o.input.searchFilter)),e.forEach(n,function(e){o.setSelectedItem(e[o.settings.idProp],!0,!1)}),o.externalEvents.onSelectionChanged(),o.selectedGroup=null},o.deselectAll=function(e){(e=e||!1)||o.externalEvents.onDeselectAll(),o.singleSelection?d(o.selectedModel):o.selectedModel.splice(0,o.selectedModel.length),e||o.externalEvents.onSelectionChanged(),o.selectedGroup=null},o.setSelectedItem=function(t,n,l,i){var r,c,g,p=a(t),u=null;if(u=""===o.settings.externalIdProp?(r=o.options,c=p,r.some(function(e){var t=!0;if(Object.keys(c).forEach(function(n){e[n]!==c[n]&&(t=!1)}),t)return g=e,!0}),g):p,o.singleSelection)d(o.selectedModel),e.extend(o.selectedModel,u),l&&o.externalEvents.onItemSelect(u,i),(o.settings.closeOnSelect||o.settings.closeOnDeselect)&&o.close();else{n=n||!1;var h=-1!==s(o.selectedModel,p);!n&&h?(o.selectedModel.splice(s(o.selectedModel,p),1),o.externalEvents.onItemDeselect(u,i),o.settings.closeOnDeselect&&o.close()):!h&&(0===o.settings.selectionLimit||o.selectedModel.length<o.settings.selectionLimit)&&(o.selectedModel.push(u),l&&o.externalEvents.onItemSelect(u,i),o.settings.closeOnSelect&&o.close(),o.settings.selectionLimit>0&&o.selectedModel.length===o.settings.selectionLimit&&o.externalEvents.onMaxSelectionReached())}l&&o.externalEvents.onSelectionChanged(),o.selectedGroup=null},o.isChecked=function(t){return o.singleSelection?null!==o.selectedModel&&e.isDefined(o.selectedModel[o.settings.externalIdProp])&&o.selectedModel[o.settings.externalIdProp]===a(t)[o.settings.externalIdProp]:-1!==s(o.selectedModel,a(t))},o.externalEvents.onInitDone(),o.keyDownLink=function(t){var n,s=e.element(t.target).scope(),l=t.target.parentNode;if(o.settings.keyboardControls){if(13===t.keyCode||32===t.keyCode)t.preventDefault(),s.option?o.setSelectedItem(o.getPropertyForObject(s.option,o.settings.idProp),!1,!0,t):"deselectAll"===t.target.id?o.deselectAll():"selectAll"===t.target.id&&o.selectAll();else if(38===t.keyCode){for(t.preventDefault(),l.previousElementSibling&&(n=l.previousElementSibling.querySelector("a")||l.previousElementSibling.querySelector("input"));!n&&l;)(l=l.previousElementSibling)&&(n=l.querySelector("a")||l.querySelector("input"));n&&n.focus()}else if(40===t.keyCode){for(t.preventDefault(),l.nextElementSibling&&(n=l.nextElementSibling.querySelector("a")||l.nextElementSibling.querySelector("input"));!n&&l;)(l=l.nextElementSibling)&&(n=l.querySelector("a")||l.querySelector("input"));n&&n.focus()}else 27===t.keyCode&&(t.preventDefault(),o.toggleDropdown())}},o.keyDownSearchDefault=function(e){var t,n=e.target.parentNode.parentNode;if(o.settings.keyboardControls){if(9===e.keyCode||40===e.keyCode)e.preventDefault(),p();else if(38===e.keyCode){for(e.preventDefault(),n.previousElementSibling&&(t=n.previousElementSibling.querySelector("a")||n.previousElementSibling.querySelector("input"));!t&&n;)(n=n.previousElementSibling)&&(t=n.querySelector("a")||n.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),o.toggleDropdown())}},o.keyDownSearch=function(e,n){var s;o.settings.keyboardControls&&13===e.keyCode&&(1===o.settings.selectionLimit&&o.settings.enableSearch?1===(s=t("filter")(o.options,o.getFilter(n))).length&&o.setSelectedItem(o.getPropertyForObject(s[0],o.settings.idProp),!1,!0,e):o.settings.enableSearch&&o.selectAll())},o.getFilter=function(e){var t={};return t[o.settings.searchField]=e,t},o.toggleSearch=function(e){e&&e.stopPropagation(),o.settings.enableSearch=!o.settings.enableSearch,o.settings.enableSearch||(o.input.searchFilter="")},o.keyDownToggleSearch=function(){o.settings.keyboardControls&&13===event.keyCode&&(o.toggleSearch(),o.settings.enableSearch?setTimeout(function(){e.element(i)[0].querySelector(".searchField").focus()},0):p())},o.updateSetting=function(e,t){o.settings[e]=t}}}}])}(angular);